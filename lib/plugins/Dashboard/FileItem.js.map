{"version":3,"sources":["../../../src/plugins/Dashboard/FileItem.js"],"names":["getFileNameAndExtension","require","truncateString","copyToClipboard","prettyBytes","FileItemProgress","getFileTypeIcon","FilePreview","iconEdit","iconCopy","iconRetry","classNames","h","FileItemProgressWrapper","props","hideRetryButton","error","isUploaded","bundled","hidePauseResumeCancelButtons","file","progress","percentage","id","emitDeleteFileEvent","progressIndicatorTitle","onPauseResumeCancelRetry","module","exports","fileItem","acquirers","isProcessing","preprocess","postprocess","uploadComplete","uploadInProgressOrComplete","uploadStarted","uploadInProgress","isPaused","fileName","meta","name","truncatedFileName","isWide","ev","retryUpload","resumableUploads","pauseUpload","cancelUpload","dashboardItemClass","bundledUpload","i18n","backgroundColor","type","color","showLinkToFileUploadResult","uploadURL","extension","data","size","source","map","acquirer","icon","metaFields","length","e","toggleFileCard","then","log","info","catch","removeFile"],"mappings":";;AAAA,IAAMA,0BAA0BC,QAAQ,qCAAR,CAAhC;AACA,IAAMC,iBAAiBD,QAAQ,4BAAR,CAAvB;AACA,IAAME,kBAAkBF,QAAQ,6BAAR,CAAxB;AACA,IAAMG,cAAcH,QAAQ,gBAAR,CAApB;AACA,IAAMI,mBAAmBJ,QAAQ,oBAAR,CAAzB;AACA,IAAMK,kBAAkBL,QAAQ,mBAAR,CAAxB;AACA,IAAMM,cAAcN,QAAQ,eAAR,CAApB;;eAC0CA,QAAQ,SAAR,C;IAAlCO,Q,YAAAA,Q;IAAUC,Q,YAAAA,Q;IAAUC,S,YAAAA,S;;AAC5B,IAAMC,aAAaV,QAAQ,YAAR,CAAnB;;gBACcA,QAAQ,QAAR,C;IAANW,C,aAAAA,C;;AAER,IAAMC,0BAA0B,SAA1BA,uBAA0B,CAACC,KAAD,EAAW;AACzC,MAAIA,MAAMC,eAAN,IAAyBD,MAAME,KAAnC,EAA0C;AACxC;AACD;;AAED,MAAIF,MAAMG,UAAN,IACAH,MAAMI,OADN,IAECJ,MAAMK,4BAAN,IAAsC,CAACL,MAAME,KAFlD,EAE0D;AACxD,WAAO;AAAA;AAAA,QAAK,SAAM,sCAAX;AACL,QAAC,gBAAD;AACE,kBAAUF,MAAMM,IAAN,CAAWC,QAAX,CAAoBC,UADhC;AAEE,gBAAQR,MAAMM,IAAN,CAAWG,EAFrB;AAGE,sCAA8BT,MAAMK,4BAHtC;AAIE,iBAASL,MAAMI;AAJjB;AADK,KAAP;AAQD;;AAED,SAAO;AAAA;AAAA;AAEL;AAAA;AAAA,QAAQ,SAAM,kCAAd;AACE,cAAK,QADP;AAEE,iBAASJ,MAAMU,mBAAN,CAA0BV,MAAMM,IAAhC;AAFX;AAIE;AAAA;AAAA,UAAK,eAAY,MAAjB,EAAwB,SAAM,UAA9B,EAAyC,OAAM,IAA/C,EAAoD,QAAO,IAA3D,EAAgE,SAAQ,WAAxE,EAAoF,OAAM,4BAA1F;AACE,oBAAM,QAAO,MAAb,EAAoB,gBAAa,GAAjC,EAAqC,aAAU,SAA/C,EAAyD,iBAAc,oBAAvE,EAA4F,GAAE,yDAA9F,GADF;AAEE,oBAAM,MAAK,MAAX,EAAkB,iBAAc,oBAAhC,EAAqD,GAAE,2HAAvD;AAFF;AAJF,KAFK;AAYL;AAAA;AAAA;AACE,iBAAM,sCADR;AAEE,cAAK,QAFP;AAGE,sBAAYN,MAAMW,sBAHpB;AAIE,eAAOX,MAAMW,sBAJf;AAKE,iBAASX,MAAMY,wBALjB;AAMGZ,YAAME,KAAN,GACCF,MAAMC,eAAN,GAAwB,IAAxB,GAA+BL,WADhC,GAEC,EAAC,gBAAD;AACA,kBAAUI,MAAMM,IAAN,CAAWC,QAAX,CAAoBC,UAD9B;AAEA,gBAAQR,MAAMM,IAAN,CAAWG,EAFnB;AAGA,sCAA8BT,MAAMK;AAHpC;AARJ;AAZK,GAAP;AA4BD,CA9CD;;AAgDAQ,OAAOC,OAAP,GAAiB,SAASC,QAAT,CAAmBf,KAAnB,EAA0B;AACzC,MAAMM,OAAON,MAAMM,IAAnB;AACA,MAAMU,YAAYhB,MAAMgB,SAAxB;;AAEA,MAAMC,eAAeX,KAAKC,QAAL,CAAcW,UAAd,IAA4BZ,KAAKC,QAAL,CAAcY,WAA/D;AACA,MAAMhB,aAAaG,KAAKC,QAAL,CAAca,cAAd,IAAgC,CAACH,YAAjC,IAAiD,CAACX,KAAKJ,KAA1E;AACA,MAAMmB,6BAA6Bf,KAAKC,QAAL,CAAce,aAAd,IAA+BL,YAAlE;AACA,MAAMM,mBAAoBjB,KAAKC,QAAL,CAAce,aAAd,IAA+B,CAAChB,KAAKC,QAAL,CAAca,cAA/C,IAAkEH,YAA3F;AACA,MAAMO,WAAWlB,KAAKkB,QAAL,IAAiB,KAAlC;AACA,MAAMtB,QAAQI,KAAKJ,KAAL,IAAc,KAA5B;;AAEA,MAAMuB,WAAWvC,wBAAwBoB,KAAKoB,IAAL,CAAUC,IAAlC,EAAwCA,IAAzD;AACA,MAAMC,oBAAoB5B,MAAM6B,MAAN,GAAezC,eAAeqC,QAAf,EAAyB,EAAzB,CAAf,GAA8CA,QAAxE;;AAEA,MAAMb,2BAA2B,SAA3BA,wBAA2B,CAACkB,EAAD,EAAQ;AACvC,QAAI3B,UAAJ,EAAgB;;AAEhB,QAAID,SAAS,CAACF,MAAMC,eAApB,EAAqC;AACnCD,YAAM+B,WAAN,CAAkBzB,KAAKG,EAAvB;AACA;AACD;;AAED,QAAIT,MAAMK,4BAAV,EAAwC;AACtC;AACD;;AAED,QAAIL,MAAMgC,gBAAV,EAA4B;AAC1BhC,YAAMiC,WAAN,CAAkB3B,KAAKG,EAAvB;AACD,KAFD,MAEO;AACLT,YAAMkC,YAAN,CAAmB5B,KAAKG,EAAxB;AACD;AACF,GAjBD;;AAmBA,MAAM0B,qBAAqBtC,WACzB,oBADyB,EAEzB,EAAE,iBAAiB0B,gBAAnB,EAFyB,EAGzB,EAAE,iBAAiBN,YAAnB,EAHyB,EAIzB,EAAE,eAAed,UAAjB,EAJyB,EAKzB,EAAE,aAAaqB,QAAf,EALyB,EAMzB,EAAE,YAAYtB,KAAd,EANyB,EAOzB,EAAE,gBAAgBF,MAAMgC,gBAAxB,EAPyB,EAQzB,EAAE,cAAchC,MAAMoC,aAAtB,EARyB,CAA3B;;AAWA,MAAMzB,yBAAyBR,aAC3BH,MAAMqC,IAAN,CAAW,gBAAX,CAD2B,GAE3BrC,MAAMgC,gBAAN,GACE1B,KAAKkB,QAAL,GACExB,MAAMqC,IAAN,CAAW,cAAX,CADF,GAEErC,MAAMqC,IAAN,CAAW,aAAX,CAHJ,GAIEnC,QACEF,MAAMqC,IAAN,CAAW,aAAX,CADF,GAEErC,MAAMqC,IAAN,CAAW,cAAX,CARR;;AAUA,SAAO;AAAA;AAAA,MAAI,SAAOF,kBAAX,EAA+B,cAAY7B,KAAKG,EAAhD,EAAsD,OAAOH,KAAKoB,IAAL,CAAUC,IAAvE;AACL;AAAA;AAAA,QAAK,SAAM,4BAAX;AACE;AAAA;AAAA,UAAK,SAAM,qCAAX,EAAiD,OAAO,EAAEW,iBAAiB9C,gBAAgBc,KAAKiC,IAArB,EAA2BC,KAA9C,EAAxD;AACGxC,cAAMyC,0BAAN,IAAoCnC,KAAKoC,SAAzC,GACG,SAAG,SAAM,gCAAT,EAA0C,MAAMpC,KAAKoC,SAArD,EAAgE,KAAI,qBAApE,EAA0F,QAAO,QAAjG,GADH,GAEG,IAHN;AAKE,UAAC,WAAD,IAAa,MAAMpC,IAAnB;AALF,OADF;AASE;AAAA;AAAA,UAAK,SAAM,4CAAX;AACE,UAAC,uBAAD;AACE,kCAAwBK,sBAD1B;AAEE,oCAA0BC,wBAF5B;AAGE,gBAAMN,IAHR;AAIE,iBAAOJ;AAJT,WAKMF,KALN;AADF;AATF,KADK;AAmBL;AAAA;AAAA,QAAK,SAAM,yBAAX;AACE;AAAA;AAAA,UAAK,SAAM,yBAAX,EAAqC,OAAOyB,QAA5C;AACGzB,cAAMyC,0BAAN,IAAoCnC,KAAKoC,SAAzC,GACG;AAAA;AAAA,YAAG,MAAMpC,KAAKoC,SAAd,EAAyB,KAAI,qBAA7B,EAAmD,QAAO,QAA1D;AACCpC,eAAKqC,SAAL,GAAiBf,oBAAoB,GAApB,GAA0BtB,KAAKqC,SAAhD,GAA4Df;AAD7D,SADH,GAIGtB,KAAKqC,SAAL,GAAiBf,oBAAoB,GAApB,GAA0BtB,KAAKqC,SAAhD,GAA4Df;AALlE,OADF;AASE;AAAA;AAAA,UAAK,SAAM,2BAAX;AACGtB,aAAKsC,IAAL,CAAUC,IAAV,GAAiB;AAAA;AAAA,YAAK,SAAM,+BAAX;AAA4CvD,sBAAYgB,KAAKsC,IAAL,CAAUC,IAAtB;AAA5C,SAAjB,GAAkG,IADrG;AAEGvC,aAAKwC,MAAL,IAAe;AAAA;AAAA,YAAK,SAAM,+BAAX;AACX9B,oBAAU+B,GAAV,CAAc,oBAAY;AACzB,gBAAIC,SAASvC,EAAT,KAAgBH,KAAKwC,MAAzB,EAAiC;AAC/B,qBAAO;AAAA;AAAA,kBAAM,OAAO9C,MAAMqC,IAAN,CAAW,YAAX,EAAyB,EAAEV,MAAMqB,SAASrB,IAAjB,EAAzB,CAAb;AACJqB,yBAASC,IAAT;AADI,eAAP;AAGD;AACF,WANA;AADW;AAFlB,OATF;AA4BI5B,oCAA8BrB,MAAMkD,UAApC,IAAkDlD,MAAMkD,UAAN,CAAiBC,MAApE,GACG;AAAA;AAAA,UAAQ,SAAM,yBAAd;AACA,gBAAK,QADL;AAEA,wBAAYnD,MAAMqC,IAAN,CAAW,UAAX,CAFZ;AAGA,iBAAOrC,MAAMqC,IAAN,CAAW,UAAX,CAHP;AAIA,mBAAS,iBAACe,CAAD;AAAA,mBAAOpD,MAAMqD,cAAN,CAAqB/C,KAAKG,EAA1B,CAAP;AAAA,WAJT;AAKCf;AALD,OADH,GAQG,IApCN;AAsCGM,YAAMyC,0BAAN,IAAoCnC,KAAKoC,SAAzC,GACG;AAAA;AAAA,UAAQ,SAAM,6BAAd;AACA,gBAAK,QADL;AAEA,wBAAY1C,MAAMqC,IAAN,CAAW,UAAX,CAFZ;AAGA,iBAAOrC,MAAMqC,IAAN,CAAW,UAAX,CAHP;AAIA,mBAAS,mBAAM;AACbhD,4BAAgBiB,KAAKoC,SAArB,EAAgC1C,MAAMqC,IAAN,CAAW,6BAAX,CAAhC,EACGiB,IADH,CACQ,YAAM;AACVtD,oBAAMuD,GAAN,CAAU,2BAAV;AACAvD,oBAAMwD,IAAN,CAAWxD,MAAMqC,IAAN,CAAW,4BAAX,CAAX,EAAqD,MAArD,EAA6D,IAA7D;AACD,aAJH,EAKGoB,KALH,CAKSzD,MAAMuD,GALf;AAMD,WAXD;AAWI5D;AAXJ,OADH,GAaG;AAnDN,KAnBK;AAyEL;AAAA;AAAA,QAAK,SAAM,2BAAX;AACG,OAACQ,UAAD,IACC;AAAA;AAAA,UAAQ,SAAM,2BAAd;AACE,gBAAK,QADP;AAEE,wBAAYH,MAAMqC,IAAN,CAAW,YAAX,CAFd;AAGE,iBAAOrC,MAAMqC,IAAN,CAAW,YAAX,CAHT;AAIE,mBAAS;AAAA,mBAAMrC,MAAM0D,UAAN,CAAiBpD,KAAKG,EAAtB,CAAN;AAAA,WAJX;AAKE;AAAA;AAAA,YAAK,eAAY,MAAjB,EAAwB,SAAM,UAA9B,EAAyC,OAAM,IAA/C,EAAoD,QAAO,IAA3D,EAAgE,SAAQ,WAAxE,EAAoF,OAAM,4BAA1F;AACE,sBAAM,QAAO,MAAb,EAAoB,gBAAa,GAAjC,EAAqC,aAAU,SAA/C,EAAyD,iBAAc,oBAAvE,EAA4F,GAAE,yDAA9F,GADF;AAEE,sBAAM,MAAK,MAAX,EAAkB,iBAAc,oBAAhC,EAAqD,GAAE,2HAAvD;AAFF;AALF;AAFJ;AAzEK,GAAP;AAwFD,CA9ID","file":"FileItem.js","sourcesContent":["const getFileNameAndExtension = require('../../utils/getFileNameAndExtension')\r\nconst truncateString = require('../../utils/truncateString')\r\nconst copyToClipboard = require('../../utils/copyToClipboard')\r\nconst prettyBytes = require('prettier-bytes')\r\nconst FileItemProgress = require('./FileItemProgress')\r\nconst getFileTypeIcon = require('./getFileTypeIcon')\r\nconst FilePreview = require('./FilePreview')\r\nconst { iconEdit, iconCopy, iconRetry } = require('./icons')\r\nconst classNames = require('classnames')\r\nconst { h } = require('preact')\r\n\r\nconst FileItemProgressWrapper = (props) => {\r\n  if (props.hideRetryButton && props.error) {\r\n    return\r\n  }\r\n\r\n  if (props.isUploaded ||\r\n      props.bundled ||\r\n      (props.hidePauseResumeCancelButtons && !props.error)) {\r\n    return <div class=\"uppy-DashboardItem-progressIndicator\">\r\n      <FileItemProgress\r\n        progress={props.file.progress.percentage}\r\n        fileID={props.file.id}\r\n        hidePauseResumeCancelButtons={props.hidePauseResumeCancelButtons}\r\n        bundled={props.bundled}\r\n      />\r\n    </div>\r\n  }\r\n\r\n  return <div>\r\n    {/* START added delete button */}\r\n    <button class=\"uppy-DashboardItem-remove delete\"\r\n      type=\"button\"\r\n      onclick={props.emitDeleteFileEvent(props.file)}\r\n    >\r\n      <svg aria-hidden=\"true\" class=\"UppyIcon\" width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <path stroke=\"#FFF\" stroke-width=\"1\" fill-rule=\"nonzero\" vector-effect=\"non-scaling-stroke\" d=\"M30 1C14 1 1 14 1 30s13 29 29 29 29-13 29-29S46 1 30 1z\" />\r\n        <path fill=\"#FFF\" vector-effect=\"non-scaling-stroke\" d=\"M42 39.667L39.667 42 30 32.333 20.333 42 18 39.667 27.667 30 18 20.333 20.333 18 30 27.667 39.667 18 42 20.333 32.333 30z\" />\r\n      </svg>\r\n    </button>\r\n    {/* FINISH */}\r\n    <button\r\n      class=\"uppy-DashboardItem-progressIndicator\"\r\n      type=\"button\"\r\n      aria-label={props.progressIndicatorTitle}\r\n      title={props.progressIndicatorTitle}\r\n      onclick={props.onPauseResumeCancelRetry}>\r\n      {props.error\r\n      ? props.hideRetryButton ? null : iconRetry()\r\n      : <FileItemProgress\r\n        progress={props.file.progress.percentage}\r\n        fileID={props.file.id}\r\n        hidePauseResumeCancelButtons={props.hidePauseResumeCancelButtons}\r\n      />\r\n    }\r\n    </button>\r\n  </div>\r\n}\r\n\r\nmodule.exports = function fileItem (props) {\r\n  const file = props.file\r\n  const acquirers = props.acquirers\r\n\r\n  const isProcessing = file.progress.preprocess || file.progress.postprocess\r\n  const isUploaded = file.progress.uploadComplete && !isProcessing && !file.error\r\n  const uploadInProgressOrComplete = file.progress.uploadStarted || isProcessing\r\n  const uploadInProgress = (file.progress.uploadStarted && !file.progress.uploadComplete) || isProcessing\r\n  const isPaused = file.isPaused || false\r\n  const error = file.error || false\r\n\r\n  const fileName = getFileNameAndExtension(file.meta.name).name\r\n  const truncatedFileName = props.isWide ? truncateString(fileName, 14) : fileName\r\n\r\n  const onPauseResumeCancelRetry = (ev) => {\r\n    if (isUploaded) return\r\n\r\n    if (error && !props.hideRetryButton) {\r\n      props.retryUpload(file.id)\r\n      return\r\n    }\r\n\r\n    if (props.hidePauseResumeCancelButtons) {\r\n      return\r\n    }\r\n\r\n    if (props.resumableUploads) {\r\n      props.pauseUpload(file.id)\r\n    } else {\r\n      props.cancelUpload(file.id)\r\n    }\r\n  }\r\n\r\n  const dashboardItemClass = classNames(\r\n    'uppy-DashboardItem',\r\n    { 'is-inprogress': uploadInProgress },\r\n    { 'is-processing': isProcessing },\r\n    { 'is-complete': isUploaded },\r\n    { 'is-paused': isPaused },\r\n    { 'is-error': error },\r\n    { 'is-resumable': props.resumableUploads },\r\n    { 'is-bundled': props.bundledUpload }\r\n  )\r\n\r\n  const progressIndicatorTitle = isUploaded\r\n    ? props.i18n('uploadComplete')\r\n    : props.resumableUploads\r\n      ? file.isPaused\r\n        ? props.i18n('resumeUpload')\r\n        : props.i18n('pauseUpload')\r\n      : error\r\n        ? props.i18n('retryUpload')\r\n        : props.i18n('cancelUpload')\r\n\r\n  return <li class={dashboardItemClass} id={`uppy_${file.id}`} title={file.meta.name}>\r\n    <div class=\"uppy-DashboardItem-preview\">\r\n      <div class=\"uppy-DashboardItem-previewInnerWrap\" style={{ backgroundColor: getFileTypeIcon(file.type).color }}>\r\n        {props.showLinkToFileUploadResult && file.uploadURL\r\n          ? <a class=\"uppy-DashboardItem-previewLink\" href={file.uploadURL} rel=\"noreferrer noopener\" target=\"_blank\" />\r\n          : null\r\n        }\r\n        <FilePreview file={file} />\r\n      </div>\r\n      {/* START added class action-buttons FINISH */}\r\n      <div class=\"uppy-DashboardItem-progress action-buttons\">\r\n        <FileItemProgressWrapper\r\n          progressIndicatorTitle={progressIndicatorTitle}\r\n          onPauseResumeCancelRetry={onPauseResumeCancelRetry}\r\n          file={file}\r\n          error={error}\r\n          {...props} />\r\n      </div>\r\n    </div>\r\n    <div class=\"uppy-DashboardItem-info\">\r\n      <div class=\"uppy-DashboardItem-name\" title={fileName}>\r\n        {props.showLinkToFileUploadResult && file.uploadURL\r\n          ? <a href={file.uploadURL} rel=\"noreferrer noopener\" target=\"_blank\">\r\n            {file.extension ? truncatedFileName + '.' + file.extension : truncatedFileName}\r\n          </a>\r\n          : file.extension ? truncatedFileName + '.' + file.extension : truncatedFileName\r\n        }\r\n      </div>\r\n      <div class=\"uppy-DashboardItem-status\">\r\n        {file.data.size ? <div class=\"uppy-DashboardItem-statusSize\">{prettyBytes(file.data.size)}</div> : null}\r\n        {file.source && <div class=\"uppy-DashboardItem-sourceIcon\">\r\n            {acquirers.map(acquirer => {\r\n              if (acquirer.id === file.source) {\r\n                return <span title={props.i18n('fileSource', { name: acquirer.name })}>\r\n                  {acquirer.icon()}\r\n                </span>\r\n              }\r\n            })}\r\n          </div>\r\n        }\r\n      </div>\r\n      {/*\r\n      START\r\n      We need to show the edit button after the file is uploaded, and not show the edit button before the file is uploaded\r\n      {(!uploadInProgressOrComplete && props.metaFields && props.metaFields.length)\r\n      FINISH\r\n      */}\r\n      {(uploadInProgressOrComplete && props.metaFields && props.metaFields.length)\r\n        ? <button class=\"uppy-DashboardItem-edit\"\r\n          type=\"button\"\r\n          aria-label={props.i18n('editFile')}\r\n          title={props.i18n('editFile')}\r\n          onclick={(e) => props.toggleFileCard(file.id)}>\r\n          {iconEdit()}\r\n        </button>\r\n        : null\r\n      }\r\n      {props.showLinkToFileUploadResult && file.uploadURL\r\n        ? <button class=\"uppy-DashboardItem-copyLink\"\r\n          type=\"button\"\r\n          aria-label={props.i18n('copyLink')}\r\n          title={props.i18n('copyLink')}\r\n          onclick={() => {\r\n            copyToClipboard(file.uploadURL, props.i18n('copyLinkToClipboardFallback'))\r\n              .then(() => {\r\n                props.log('Link copied to clipboard.')\r\n                props.info(props.i18n('copyLinkToClipboardSuccess'), 'info', 3000)\r\n              })\r\n              .catch(props.log)\r\n          }}>{iconCopy()}</button>\r\n        : ''\r\n      }\r\n    </div>\r\n    <div class=\"uppy-DashboardItem-action\">\r\n      {!isUploaded &&\r\n        <button class=\"uppy-DashboardItem-remove\"\r\n          type=\"button\"\r\n          aria-label={props.i18n('removeFile')}\r\n          title={props.i18n('removeFile')}\r\n          onclick={() => props.removeFile(file.id)}>\r\n          <svg aria-hidden=\"true\" class=\"UppyIcon\" width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path stroke=\"#FFF\" stroke-width=\"1\" fill-rule=\"nonzero\" vector-effect=\"non-scaling-stroke\" d=\"M30 1C14 1 1 14 1 30s13 29 29 29 29-13 29-29S46 1 30 1z\" />\r\n            <path fill=\"#FFF\" vector-effect=\"non-scaling-stroke\" d=\"M42 39.667L39.667 42 30 32.333 20.333 42 18 39.667 27.667 30 18 20.333 20.333 18 30 27.667 39.667 18 42 20.333 32.333 30z\" />\r\n          </svg>\r\n        </button>\r\n      }\r\n    </div>\r\n  </li>\r\n}\r\n"]}