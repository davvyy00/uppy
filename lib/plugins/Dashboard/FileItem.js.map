{"version":3,"sources":["../../../src/plugins/Dashboard/FileItem.js"],"names":["getFileNameAndExtension","require","truncateString","copyToClipboard","prettyBytes","FileItemProgress","getFileTypeIcon","FilePreview","iconEdit","iconCopy","iconRetry","classNames","h","FileItemProgressWrapper","props","hideRetryButton","error","isUploaded","bundled","hidePauseResumeCancelButtons","file","progress","percentage","id","emitDeleteFileEvent","progressIndicatorTitle","onPauseResumeCancelRetry","module","exports","fileItem","acquirers","isProcessing","preprocess","postprocess","uploadComplete","uploadInProgressOrComplete","uploadStarted","uploadInProgress","isPaused","fileName","meta","name","truncatedFileName","isWide","ev","retryUpload","resumableUploads","pauseUpload","cancelUpload","dashboardItemClass","bundledUpload","i18n","backgroundColor","type","color","showLinkToFileUploadResult","uploadURL","extension","data","size","source","map","acquirer","icon","metaFields","length","e","toggleFileCard","then","log","info","catch","removeFile"],"mappings":"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","file":"FileItem.js","sourcesContent":["const getFileNameAndExtension = require('../../utils/getFileNameAndExtension')\nconst truncateString = require('../../utils/truncateString')\nconst copyToClipboard = require('../../utils/copyToClipboard')\nconst prettyBytes = require('prettier-bytes')\nconst FileItemProgress = require('./FileItemProgress')\nconst getFileTypeIcon = require('./getFileTypeIcon')\nconst FilePreview = require('./FilePreview')\nconst { iconEdit, iconCopy, iconRetry } = require('./icons')\nconst classNames = require('classnames')\nconst { h } = require('preact')\n\nconst FileItemProgressWrapper = (props) => {\n  if (props.hideRetryButton && props.error) {\n    return\n  }\n\n  if (props.isUploaded ||\n      props.bundled ||\n      (props.hidePauseResumeCancelButtons && !props.error)) {\n    return <div class=\"uppy-DashboardItem-progressIndicator\">\n      <FileItemProgress\n        progress={props.file.progress.percentage}\n        fileID={props.file.id}\n        hidePauseResumeCancelButtons={props.hidePauseResumeCancelButtons}\n        bundled={props.bundled}\n      />\n    </div>\n  }\n\n  return <div>\n    {/* START added delete button */}\n    <button class=\"uppy-DashboardItem-remove delete\"\n      type=\"button\"\n      onclick={props.emitDeleteFileEvent(props.file)}\n    >\n      <svg aria-hidden=\"true\" class=\"UppyIcon\" width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path stroke=\"#FFF\" stroke-width=\"1\" fill-rule=\"nonzero\" vector-effect=\"non-scaling-stroke\" d=\"M30 1C14 1 1 14 1 30s13 29 29 29 29-13 29-29S46 1 30 1z\" />\n        <path fill=\"#FFF\" vector-effect=\"non-scaling-stroke\" d=\"M42 39.667L39.667 42 30 32.333 20.333 42 18 39.667 27.667 30 18 20.333 20.333 18 30 27.667 39.667 18 42 20.333 32.333 30z\" />\n      </svg>\n    </button>\n    {/* FINISH */}\n    <button\n      class=\"uppy-DashboardItem-progressIndicator\"\n      type=\"button\"\n      aria-label={props.progressIndicatorTitle}\n      title={props.progressIndicatorTitle}\n      onclick={props.onPauseResumeCancelRetry}>\n      {props.error\n      ? props.hideRetryButton ? null : iconRetry()\n      : <FileItemProgress\n        progress={props.file.progress.percentage}\n        fileID={props.file.id}\n        hidePauseResumeCancelButtons={props.hidePauseResumeCancelButtons}\n      />\n    }\n    </button>\n  </div>\n}\n\nmodule.exports = function fileItem (props) {\n  const file = props.file\n  const acquirers = props.acquirers\n\n  const isProcessing = file.progress.preprocess || file.progress.postprocess\n  const isUploaded = file.progress.uploadComplete && !isProcessing && !file.error\n  const uploadInProgressOrComplete = file.progress.uploadStarted || isProcessing\n  const uploadInProgress = (file.progress.uploadStarted && !file.progress.uploadComplete) || isProcessing\n  const isPaused = file.isPaused || false\n  const error = file.error || false\n\n  const fileName = getFileNameAndExtension(file.meta.name).name\n  const truncatedFileName = props.isWide ? truncateString(fileName, 14) : fileName\n\n  const onPauseResumeCancelRetry = (ev) => {\n    if (isUploaded) return\n\n    if (error && !props.hideRetryButton) {\n      props.retryUpload(file.id)\n      return\n    }\n\n    if (props.hidePauseResumeCancelButtons) {\n      return\n    }\n\n    if (props.resumableUploads) {\n      props.pauseUpload(file.id)\n    } else {\n      props.cancelUpload(file.id)\n    }\n  }\n\n  const dashboardItemClass = classNames(\n    'uppy-DashboardItem',\n    { 'is-inprogress': uploadInProgress },\n    { 'is-processing': isProcessing },\n    { 'is-complete': isUploaded },\n    { 'is-paused': isPaused },\n    { 'is-error': error },\n    { 'is-resumable': props.resumableUploads },\n    { 'is-bundled': props.bundledUpload }\n  )\n\n  const progressIndicatorTitle = isUploaded\n    ? props.i18n('uploadComplete')\n    : props.resumableUploads\n      ? file.isPaused\n        ? props.i18n('resumeUpload')\n        : props.i18n('pauseUpload')\n      : error\n        ? props.i18n('retryUpload')\n        : props.i18n('cancelUpload')\n\n  return <li class={dashboardItemClass} id={`uppy_${file.id}`} title={file.meta.name}>\n    <div class=\"uppy-DashboardItem-preview\">\n      <div class=\"uppy-DashboardItem-previewInnerWrap\" style={{ backgroundColor: getFileTypeIcon(file.type).color }}>\n        {props.showLinkToFileUploadResult && file.uploadURL\n          ? <a class=\"uppy-DashboardItem-previewLink\" href={file.uploadURL} rel=\"noreferrer noopener\" target=\"_blank\" />\n          : null\n        }\n        <FilePreview file={file} />\n      </div>\n      {/* START added class action-buttons FINISH */}\n      <div class=\"uppy-DashboardItem-progress action-buttons\">\n        <FileItemProgressWrapper\n          progressIndicatorTitle={progressIndicatorTitle}\n          onPauseResumeCancelRetry={onPauseResumeCancelRetry}\n          file={file}\n          error={error}\n          {...props} />\n      </div>\n    </div>\n    <div class=\"uppy-DashboardItem-info\">\n      <div class=\"uppy-DashboardItem-name\" title={fileName}>\n        {props.showLinkToFileUploadResult && file.uploadURL\n          ? <a href={file.uploadURL} rel=\"noreferrer noopener\" target=\"_blank\">\n            {file.extension ? truncatedFileName + '.' + file.extension : truncatedFileName}\n          </a>\n          : file.extension ? truncatedFileName + '.' + file.extension : truncatedFileName\n        }\n      </div>\n      <div class=\"uppy-DashboardItem-status\">\n        {file.data.size ? <div class=\"uppy-DashboardItem-statusSize\">{prettyBytes(file.data.size)}</div> : null}\n        {file.source && <div class=\"uppy-DashboardItem-sourceIcon\">\n            {acquirers.map(acquirer => {\n              if (acquirer.id === file.source) {\n                return <span title={props.i18n('fileSource', { name: acquirer.name })}>\n                  {acquirer.icon()}\n                </span>\n              }\n            })}\n          </div>\n        }\n      </div>\n      {/*\n      START\n      We need to show the edit button after the file is uploaded, and not show the edit button before the file is uploaded\n      {(!uploadInProgressOrComplete && props.metaFields && props.metaFields.length)\n      FINISH\n      */}\n      {(uploadInProgressOrComplete && props.metaFields && props.metaFields.length)\n        ? <button class=\"uppy-DashboardItem-edit\"\n          type=\"button\"\n          aria-label={props.i18n('editFile')}\n          title={props.i18n('editFile')}\n          onclick={(e) => props.toggleFileCard(file.id)}>\n          {iconEdit()}\n        </button>\n        : null\n      }\n      {props.showLinkToFileUploadResult && file.uploadURL\n        ? <button class=\"uppy-DashboardItem-copyLink\"\n          type=\"button\"\n          aria-label={props.i18n('copyLink')}\n          title={props.i18n('copyLink')}\n          onclick={() => {\n            copyToClipboard(file.uploadURL, props.i18n('copyLinkToClipboardFallback'))\n              .then(() => {\n                props.log('Link copied to clipboard.')\n                props.info(props.i18n('copyLinkToClipboardSuccess'), 'info', 3000)\n              })\n              .catch(props.log)\n          }}>{iconCopy()}</button>\n        : ''\n      }\n    </div>\n    <div class=\"uppy-DashboardItem-action\">\n      {!isUploaded &&\n        <button class=\"uppy-DashboardItem-remove\"\n          type=\"button\"\n          aria-label={props.i18n('removeFile')}\n          title={props.i18n('removeFile')}\n          onclick={() => props.removeFile(file.id)}>\n          <svg aria-hidden=\"true\" class=\"UppyIcon\" width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path stroke=\"#FFF\" stroke-width=\"1\" fill-rule=\"nonzero\" vector-effect=\"non-scaling-stroke\" d=\"M30 1C14 1 1 14 1 30s13 29 29 29 29-13 29-29S46 1 30 1z\" />\n            <path fill=\"#FFF\" vector-effect=\"non-scaling-stroke\" d=\"M42 39.667L39.667 42 30 32.333 20.333 42 18 39.667 27.667 30 18 20.333 20.333 18 30 27.667 39.667 18 42 20.333 32.333 30z\" />\n          </svg>\n        </button>\n      }\n    </div>\n  </li>\n}\n"]}