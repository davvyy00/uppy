{"version":3,"sources":["../../../src/plugins/Dashboard/FileItem.js"],"names":["getFileNameAndExtension","require","truncateString","copyToClipboard","prettyBytes","FileItemProgress","getFileTypeIcon","FilePreview","iconEdit","iconCopy","iconRetry","classNames","h","FileItemProgressWrapper","props","hideRetryButton","error","isUploaded","bundled","hidePauseResumeCancelButtons","file","progress","percentage","id","progressIndicatorTitle","onPauseResumeCancelRetry","module","exports","fileItem","acquirers","isProcessing","preprocess","postprocess","uploadComplete","uploadInProgressOrComplete","uploadStarted","uploadInProgress","isPaused","fileName","meta","name","truncatedFileName","isWide","ev","retryUpload","resumableUploads","pauseUpload","cancelUpload","dashboardItemClass","bundledUpload","i18n","backgroundColor","type","color","showLinkToFileUploadResult","uploadURL","extension","data","size","source","map","acquirer","icon","metaFields","length","e","toggleFileCard","then","log","info","catch","removeFile"],"mappings":";;AAAA,IAAMA,0BAA0BC,QAAQ,qCAAR,CAAhC;AACA,IAAMC,iBAAiBD,QAAQ,4BAAR,CAAvB;AACA,IAAME,kBAAkBF,QAAQ,6BAAR,CAAxB;AACA,IAAMG,cAAcH,QAAQ,gBAAR,CAApB;AACA,IAAMI,mBAAmBJ,QAAQ,oBAAR,CAAzB;AACA,IAAMK,kBAAkBL,QAAQ,mBAAR,CAAxB;AACA,IAAMM,cAAcN,QAAQ,eAAR,CAApB;;eAC0CA,QAAQ,SAAR,C;IAAlCO,Q,YAAAA,Q;IAAUC,Q,YAAAA,Q;IAAUC,S,YAAAA,S;;AAC5B,IAAMC,aAAaV,QAAQ,YAAR,CAAnB;;gBACcA,QAAQ,QAAR,C;IAANW,C,aAAAA,C;;AAER,IAAMC,0BAA0B,SAA1BA,uBAA0B,CAACC,KAAD,EAAW;AACzC,MAAIA,MAAMC,eAAN,IAAyBD,MAAME,KAAnC,EAA0C;AACxC;AACD;;AAED,MAAIF,MAAMG,UAAN,IACAH,MAAMI,OADN,IAECJ,MAAMK,4BAAN,IAAsC,CAACL,MAAME,KAFlD,EAE0D;AACxD,WAAO;AAAA;AAAA,QAAK,SAAM,sCAAX;AACL,QAAC,gBAAD;AACE,kBAAUF,MAAMM,IAAN,CAAWC,QAAX,CAAoBC,UADhC;AAEE,gBAAQR,MAAMM,IAAN,CAAWG,EAFrB;AAGE,sCAA8BT,MAAMK,4BAHtC;AAIE,iBAASL,MAAMI;AAJjB;AADK,KAAP;AAQD;;AAED,SAAO;AAAA;AAAA;AACL,eAAM,sCADD;AAEL,YAAK,QAFA;AAGL,oBAAYJ,MAAMU,sBAHb;AAIL,aAAOV,MAAMU,sBAJR;AAKL,eAASV,MAAMW,wBALV;AAMJX,UAAME,KAAN,GACGF,MAAMC,eAAN,GAAwB,IAAxB,GAA+BL,WADlC,GAEG,EAAC,gBAAD;AACA,gBAAUI,MAAMM,IAAN,CAAWC,QAAX,CAAoBC,UAD9B;AAEA,cAAQR,MAAMM,IAAN,CAAWG,EAFnB;AAGA,oCAA8BT,MAAMK;AAHpC;AARC,GAAP;AAeD,CAjCD;;AAmCAO,OAAOC,OAAP,GAAiB,SAASC,QAAT,CAAmBd,KAAnB,EAA0B;AACzC,MAAMM,OAAON,MAAMM,IAAnB;AACA,MAAMS,YAAYf,MAAMe,SAAxB;;AAEA,MAAMC,eAAeV,KAAKC,QAAL,CAAcU,UAAd,IAA4BX,KAAKC,QAAL,CAAcW,WAA/D;AACA,MAAMf,aAAaG,KAAKC,QAAL,CAAcY,cAAd,IAAgC,CAACH,YAAjC,IAAiD,CAACV,KAAKJ,KAA1E;AACA,MAAMkB,6BAA6Bd,KAAKC,QAAL,CAAcc,aAAd,IAA+BL,YAAlE;AACA,MAAMM,mBAAoBhB,KAAKC,QAAL,CAAcc,aAAd,IAA+B,CAACf,KAAKC,QAAL,CAAcY,cAA/C,IAAkEH,YAA3F;AACA,MAAMO,WAAWjB,KAAKiB,QAAL,IAAiB,KAAlC;AACA,MAAMrB,QAAQI,KAAKJ,KAAL,IAAc,KAA5B;;AAEA,MAAMsB,WAAWtC,wBAAwBoB,KAAKmB,IAAL,CAAUC,IAAlC,EAAwCA,IAAzD;AACA,MAAMC,oBAAoB3B,MAAM4B,MAAN,GAAexC,eAAeoC,QAAf,EAAyB,EAAzB,CAAf,GAA8CA,QAAxE;;AAEA,MAAMb,2BAA2B,SAA3BA,wBAA2B,CAACkB,EAAD,EAAQ;AACvC,QAAI1B,UAAJ,EAAgB;;AAEhB,QAAID,SAAS,CAACF,MAAMC,eAApB,EAAqC;AACnCD,YAAM8B,WAAN,CAAkBxB,KAAKG,EAAvB;AACA;AACD;;AAED,QAAIT,MAAMK,4BAAV,EAAwC;AACtC;AACD;;AAED,QAAIL,MAAM+B,gBAAV,EAA4B;AAC1B/B,YAAMgC,WAAN,CAAkB1B,KAAKG,EAAvB;AACD,KAFD,MAEO;AACLT,YAAMiC,YAAN,CAAmB3B,KAAKG,EAAxB;AACD;AACF,GAjBD;;AAmBA,MAAMyB,qBAAqBrC,WACzB,oBADyB,EAEzB,EAAE,iBAAiByB,gBAAnB,EAFyB,EAGzB,EAAE,iBAAiBN,YAAnB,EAHyB,EAIzB,EAAE,eAAeb,UAAjB,EAJyB,EAKzB,EAAE,aAAaoB,QAAf,EALyB,EAMzB,EAAE,YAAYrB,KAAd,EANyB,EAOzB,EAAE,gBAAgBF,MAAM+B,gBAAxB,EAPyB,EAQzB,EAAE,cAAc/B,MAAMmC,aAAtB,EARyB,CAA3B;;AAWA,MAAMzB,yBAAyBP,aAC3BH,MAAMoC,IAAN,CAAW,gBAAX,CAD2B,GAE3BpC,MAAM+B,gBAAN,GACEzB,KAAKiB,QAAL,GACEvB,MAAMoC,IAAN,CAAW,cAAX,CADF,GAEEpC,MAAMoC,IAAN,CAAW,aAAX,CAHJ,GAIElC,QACEF,MAAMoC,IAAN,CAAW,aAAX,CADF,GAEEpC,MAAMoC,IAAN,CAAW,cAAX,CARR;;AAUA,SAAO;AAAA;AAAA,MAAI,SAAOF,kBAAX,EAA+B,cAAY5B,KAAKG,EAAhD,EAAsD,OAAOH,KAAKmB,IAAL,CAAUC,IAAvE;AACL;AAAA;AAAA,QAAK,SAAM,4BAAX;AACE;AAAA;AAAA,UAAK,SAAM,qCAAX,EAAiD,OAAO,EAAEW,iBAAiB7C,gBAAgBc,KAAKgC,IAArB,EAA2BC,KAA9C,EAAxD;AACGvC,cAAMwC,0BAAN,IAAoClC,KAAKmC,SAAzC,GACG,SAAG,SAAM,gCAAT,EAA0C,MAAMnC,KAAKmC,SAArD,EAAgE,KAAI,qBAApE,EAA0F,QAAO,QAAjG,GADH,GAEG,IAHN;AAKE,UAAC,WAAD,IAAa,MAAMnC,IAAnB;AALF,OADF;AAQE;AAAA;AAAA,UAAK,SAAM,6BAAX;AACE,UAAC,uBAAD;AACE,kCAAwBI,sBAD1B;AAEE,oCAA0BC,wBAF5B;AAGE,gBAAML,IAHR;AAIE,iBAAOJ;AAJT,WAKMF,KALN;AADF;AARF,KADK;AAkBL;AAAA;AAAA,QAAK,SAAM,yBAAX;AACE;AAAA;AAAA,UAAK,SAAM,yBAAX,EAAqC,OAAOwB,QAA5C;AACGxB,cAAMwC,0BAAN,IAAoClC,KAAKmC,SAAzC,GACG;AAAA;AAAA,YAAG,MAAMnC,KAAKmC,SAAd,EAAyB,KAAI,qBAA7B,EAAmD,QAAO,QAA1D;AACCnC,eAAKoC,SAAL,GAAiBf,oBAAoB,GAApB,GAA0BrB,KAAKoC,SAAhD,GAA4Df;AAD7D,SADH,GAIGrB,KAAKoC,SAAL,GAAiBf,oBAAoB,GAApB,GAA0BrB,KAAKoC,SAAhD,GAA4Df;AALlE,OADF;AASE;AAAA;AAAA,UAAK,SAAM,2BAAX;AACGrB,aAAKqC,IAAL,CAAUC,IAAV,GAAiB;AAAA;AAAA,YAAK,SAAM,+BAAX;AAA4CtD,sBAAYgB,KAAKqC,IAAL,CAAUC,IAAtB;AAA5C,SAAjB,GAAkG,IADrG;AAEGtC,aAAKuC,MAAL,IAAe;AAAA;AAAA,YAAK,SAAM,+BAAX;AACX9B,oBAAU+B,GAAV,CAAc,oBAAY;AACzB,gBAAIC,SAAStC,EAAT,KAAgBH,KAAKuC,MAAzB,EAAiC;AAC/B,qBAAO;AAAA;AAAA,kBAAM,OAAO7C,MAAMoC,IAAN,CAAW,YAAX,EAAyB,EAAEV,MAAMqB,SAASrB,IAAjB,EAAzB,CAAb;AACJqB,yBAASC,IAAT;AADI,eAAP;AAGD;AACF,WANA;AADW;AAFlB,OATF;AAsBI,OAAC5B,0BAAD,IAA+BpB,MAAMiD,UAArC,IAAmDjD,MAAMiD,UAAN,CAAiBC,MAArE,GACG;AAAA;AAAA,UAAQ,SAAM,yBAAd;AACA,gBAAK,QADL;AAEA,wBAAYlD,MAAMoC,IAAN,CAAW,UAAX,CAFZ;AAGA,iBAAOpC,MAAMoC,IAAN,CAAW,UAAX,CAHP;AAIA,mBAAS,iBAACe,CAAD;AAAA,mBAAOnD,MAAMoD,cAAN,CAAqB9C,KAAKG,EAA1B,CAAP;AAAA,WAJT;AAKCf;AALD,OADH,GAQG,IA9BN;AAgCGM,YAAMwC,0BAAN,IAAoClC,KAAKmC,SAAzC,GACG;AAAA;AAAA,UAAQ,SAAM,6BAAd;AACA,gBAAK,QADL;AAEA,wBAAYzC,MAAMoC,IAAN,CAAW,UAAX,CAFZ;AAGA,iBAAOpC,MAAMoC,IAAN,CAAW,UAAX,CAHP;AAIA,mBAAS,mBAAM;AACb/C,4BAAgBiB,KAAKmC,SAArB,EAAgCzC,MAAMoC,IAAN,CAAW,6BAAX,CAAhC,EACGiB,IADH,CACQ,YAAM;AACVrD,oBAAMsD,GAAN,CAAU,2BAAV;AACAtD,oBAAMuD,IAAN,CAAWvD,MAAMoC,IAAN,CAAW,4BAAX,CAAX,EAAqD,MAArD,EAA6D,IAA7D;AACD,aAJH,EAKGoB,KALH,CAKSxD,MAAMsD,GALf;AAMD,WAXD;AAWI3D;AAXJ,OADH,GAaG;AA7CN,KAlBK;AAkEL;AAAA;AAAA,QAAK,SAAM,2BAAX;AACG,OAACQ,UAAD,IACC;AAAA;AAAA,UAAQ,SAAM,2BAAd;AACE,gBAAK,QADP;AAEE,wBAAYH,MAAMoC,IAAN,CAAW,YAAX,CAFd;AAGE,iBAAOpC,MAAMoC,IAAN,CAAW,YAAX,CAHT;AAIE,mBAAS;AAAA,mBAAMpC,MAAMyD,UAAN,CAAiBnD,KAAKG,EAAtB,CAAN;AAAA,WAJX;AAKE;AAAA;AAAA,YAAK,eAAY,MAAjB,EAAwB,SAAM,UAA9B,EAAyC,OAAM,IAA/C,EAAoD,QAAO,IAA3D,EAAgE,SAAQ,WAAxE,EAAoF,OAAM,4BAA1F;AACE,sBAAM,QAAO,MAAb,EAAoB,gBAAa,GAAjC,EAAqC,aAAU,SAA/C,EAAyD,iBAAc,oBAAvE,EAA4F,GAAE,yDAA9F,GADF;AAEE,sBAAM,MAAK,MAAX,EAAkB,iBAAc,oBAAhC,EAAqD,GAAE,2HAAvD;AAFF;AALF;AAFJ;AAlEK,GAAP;AAiFD,CAvID","file":"FileItem.js","sourcesContent":["const getFileNameAndExtension = require('../../utils/getFileNameAndExtension')\r\nconst truncateString = require('../../utils/truncateString')\r\nconst copyToClipboard = require('../../utils/copyToClipboard')\r\nconst prettyBytes = require('prettier-bytes')\r\nconst FileItemProgress = require('./FileItemProgress')\r\nconst getFileTypeIcon = require('./getFileTypeIcon')\r\nconst FilePreview = require('./FilePreview')\r\nconst { iconEdit, iconCopy, iconRetry } = require('./icons')\r\nconst classNames = require('classnames')\r\nconst { h } = require('preact')\r\n\r\nconst FileItemProgressWrapper = (props) => {\r\n  if (props.hideRetryButton && props.error) {\r\n    return\r\n  }\r\n\r\n  if (props.isUploaded ||\r\n      props.bundled ||\r\n      (props.hidePauseResumeCancelButtons && !props.error)) {\r\n    return <div class=\"uppy-DashboardItem-progressIndicator\">\r\n      <FileItemProgress\r\n        progress={props.file.progress.percentage}\r\n        fileID={props.file.id}\r\n        hidePauseResumeCancelButtons={props.hidePauseResumeCancelButtons}\r\n        bundled={props.bundled}\r\n      />\r\n    </div>\r\n  }\r\n\r\n  return <button\r\n    class=\"uppy-DashboardItem-progressIndicator\"\r\n    type=\"button\"\r\n    aria-label={props.progressIndicatorTitle}\r\n    title={props.progressIndicatorTitle}\r\n    onclick={props.onPauseResumeCancelRetry}>\r\n    {props.error\r\n      ? props.hideRetryButton ? null : iconRetry()\r\n      : <FileItemProgress\r\n        progress={props.file.progress.percentage}\r\n        fileID={props.file.id}\r\n        hidePauseResumeCancelButtons={props.hidePauseResumeCancelButtons}\r\n      />\r\n    }\r\n  </button>\r\n}\r\n\r\nmodule.exports = function fileItem (props) {\r\n  const file = props.file\r\n  const acquirers = props.acquirers\r\n\r\n  const isProcessing = file.progress.preprocess || file.progress.postprocess\r\n  const isUploaded = file.progress.uploadComplete && !isProcessing && !file.error\r\n  const uploadInProgressOrComplete = file.progress.uploadStarted || isProcessing\r\n  const uploadInProgress = (file.progress.uploadStarted && !file.progress.uploadComplete) || isProcessing\r\n  const isPaused = file.isPaused || false\r\n  const error = file.error || false\r\n\r\n  const fileName = getFileNameAndExtension(file.meta.name).name\r\n  const truncatedFileName = props.isWide ? truncateString(fileName, 14) : fileName\r\n\r\n  const onPauseResumeCancelRetry = (ev) => {\r\n    if (isUploaded) return\r\n\r\n    if (error && !props.hideRetryButton) {\r\n      props.retryUpload(file.id)\r\n      return\r\n    }\r\n\r\n    if (props.hidePauseResumeCancelButtons) {\r\n      return\r\n    }\r\n\r\n    if (props.resumableUploads) {\r\n      props.pauseUpload(file.id)\r\n    } else {\r\n      props.cancelUpload(file.id)\r\n    }\r\n  }\r\n\r\n  const dashboardItemClass = classNames(\r\n    'uppy-DashboardItem',\r\n    { 'is-inprogress': uploadInProgress },\r\n    { 'is-processing': isProcessing },\r\n    { 'is-complete': isUploaded },\r\n    { 'is-paused': isPaused },\r\n    { 'is-error': error },\r\n    { 'is-resumable': props.resumableUploads },\r\n    { 'is-bundled': props.bundledUpload }\r\n  )\r\n\r\n  const progressIndicatorTitle = isUploaded\r\n    ? props.i18n('uploadComplete')\r\n    : props.resumableUploads\r\n      ? file.isPaused\r\n        ? props.i18n('resumeUpload')\r\n        : props.i18n('pauseUpload')\r\n      : error\r\n        ? props.i18n('retryUpload')\r\n        : props.i18n('cancelUpload')\r\n\r\n  return <li class={dashboardItemClass} id={`uppy_${file.id}`} title={file.meta.name}>\r\n    <div class=\"uppy-DashboardItem-preview\">\r\n      <div class=\"uppy-DashboardItem-previewInnerWrap\" style={{ backgroundColor: getFileTypeIcon(file.type).color }}>\r\n        {props.showLinkToFileUploadResult && file.uploadURL\r\n          ? <a class=\"uppy-DashboardItem-previewLink\" href={file.uploadURL} rel=\"noreferrer noopener\" target=\"_blank\" />\r\n          : null\r\n        }\r\n        <FilePreview file={file} />\r\n      </div>\r\n      <div class=\"uppy-DashboardItem-progress\">\r\n        <FileItemProgressWrapper\r\n          progressIndicatorTitle={progressIndicatorTitle}\r\n          onPauseResumeCancelRetry={onPauseResumeCancelRetry}\r\n          file={file}\r\n          error={error}\r\n          {...props} />\r\n      </div>\r\n    </div>\r\n    <div class=\"uppy-DashboardItem-info\">\r\n      <div class=\"uppy-DashboardItem-name\" title={fileName}>\r\n        {props.showLinkToFileUploadResult && file.uploadURL\r\n          ? <a href={file.uploadURL} rel=\"noreferrer noopener\" target=\"_blank\">\r\n            {file.extension ? truncatedFileName + '.' + file.extension : truncatedFileName}\r\n          </a>\r\n          : file.extension ? truncatedFileName + '.' + file.extension : truncatedFileName\r\n        }\r\n      </div>\r\n      <div class=\"uppy-DashboardItem-status\">\r\n        {file.data.size ? <div class=\"uppy-DashboardItem-statusSize\">{prettyBytes(file.data.size)}</div> : null}\r\n        {file.source && <div class=\"uppy-DashboardItem-sourceIcon\">\r\n            {acquirers.map(acquirer => {\r\n              if (acquirer.id === file.source) {\r\n                return <span title={props.i18n('fileSource', { name: acquirer.name })}>\r\n                  {acquirer.icon()}\r\n                </span>\r\n              }\r\n            })}\r\n          </div>\r\n        }\r\n      </div>\r\n      {(!uploadInProgressOrComplete && props.metaFields && props.metaFields.length)\r\n        ? <button class=\"uppy-DashboardItem-edit\"\r\n          type=\"button\"\r\n          aria-label={props.i18n('editFile')}\r\n          title={props.i18n('editFile')}\r\n          onclick={(e) => props.toggleFileCard(file.id)}>\r\n          {iconEdit()}\r\n        </button>\r\n        : null\r\n      }\r\n      {props.showLinkToFileUploadResult && file.uploadURL\r\n        ? <button class=\"uppy-DashboardItem-copyLink\"\r\n          type=\"button\"\r\n          aria-label={props.i18n('copyLink')}\r\n          title={props.i18n('copyLink')}\r\n          onclick={() => {\r\n            copyToClipboard(file.uploadURL, props.i18n('copyLinkToClipboardFallback'))\r\n              .then(() => {\r\n                props.log('Link copied to clipboard.')\r\n                props.info(props.i18n('copyLinkToClipboardSuccess'), 'info', 3000)\r\n              })\r\n              .catch(props.log)\r\n          }}>{iconCopy()}</button>\r\n        : ''\r\n      }\r\n    </div>\r\n    <div class=\"uppy-DashboardItem-action\">\r\n      {!isUploaded &&\r\n        <button class=\"uppy-DashboardItem-remove\"\r\n          type=\"button\"\r\n          aria-label={props.i18n('removeFile')}\r\n          title={props.i18n('removeFile')}\r\n          onclick={() => props.removeFile(file.id)}>\r\n          <svg aria-hidden=\"true\" class=\"UppyIcon\" width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path stroke=\"#FFF\" stroke-width=\"1\" fill-rule=\"nonzero\" vector-effect=\"non-scaling-stroke\" d=\"M30 1C14 1 1 14 1 30s13 29 29 29 29-13 29-29S46 1 30 1z\" />\r\n            <path fill=\"#FFF\" vector-effect=\"non-scaling-stroke\" d=\"M42 39.667L39.667 42 30 32.333 20.333 42 18 39.667 27.667 30 18 20.333 20.333 18 30 27.667 39.667 18 42 20.333 32.333 30z\" />\r\n          </svg>\r\n        </button>\r\n      }\r\n    </div>\r\n  </li>\r\n}\r\n"]}