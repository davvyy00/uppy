{"version":3,"sources":["../../../src/plugins/GoldenRetriever/ServiceWorker.js"],"names":["fileCache","Object","create","getCache","name","self","addEventListener","event","console","log","waitUntil","resolve","then","skipWaiting","clients","claim","sendMessageToAllClients","msg","matchAll","forEach","client","postMessage","addFile","store","file","id","data","removeFile","fileID","getFiles","type","files"],"mappings":";;AAAA;;AAEA,IAAMA,YAAYC,OAAOC,MAAP,CAAc,IAAd,CAAlB;;AAEA,SAASC,QAAT,CAAmBC,IAAnB,EAAyB;AACvB,MAAI,CAACJ,UAAUI,IAAV,CAAL,EAAsB;AACpBJ,cAAUI,IAAV,IAAkBH,OAAOC,MAAP,CAAc,IAAd,CAAlB;AACD;AACD,SAAOF,UAAUI,IAAV,CAAP;AACD;;AAEDC,KAAKC,gBAAL,CAAsB,SAAtB,EAAiC,UAACC,KAAD,EAAW;AAC1CC,UAAQC,GAAR,CAAY,mCAAZ;;AAEAF,QAAMG,SAAN,CAAgB,SAAQC,OAAR,GACbC,IADa,CACR;AAAA,WAAMP,KAAKQ,WAAL,EAAN;AAAA,GADQ,CAAhB;AAED,CALD;;AAOAR,KAAKC,gBAAL,CAAsB,UAAtB,EAAkC,UAACC,KAAD,EAAW;AAC3CA,QAAMG,SAAN,CAAgBL,KAAKS,OAAL,CAAaC,KAAb,EAAhB;AACD,CAFD;;AAIA,SAASC,uBAAT,CAAkCC,GAAlC,EAAuC;AACrCH,UAAQI,QAAR,GAAmBN,IAAnB,CAAwB,UAACE,OAAD,EAAa;AACnCA,YAAQK,OAAR,CAAgB,UAACC,MAAD,EAAY;AAC1BA,aAAOC,WAAP,CAAmBJ,GAAnB;AACD,KAFD;AAGD,GAJD;AAKD;;AAED,SAASK,OAAT,CAAkBC,KAAlB,EAAyBC,IAAzB,EAA+B;AAC7BrB,WAASoB,KAAT,EAAgBC,KAAKC,EAArB,IAA2BD,KAAKE,IAAhC;AACAlB,UAAQC,GAAR,CAAY,0CAAZ,EAAwDe,KAAKE,IAA7D;AACD;;AAED,SAASC,UAAT,CAAqBJ,KAArB,EAA4BK,MAA5B,EAAoC;AAClC,SAAOzB,SAASoB,KAAT,EAAgBK,MAAhB,CAAP;AACApB,UAAQC,GAAR,CAAY,8CAAZ,EAA4DmB,MAA5D;AACD;;AAED,SAASC,QAAT,CAAmBN,KAAnB,EAA0B;AACxBP,0BAAwB;AACtBc,UAAM,gBADgB;AAEtBP,WAAOA,KAFe;AAGtBQ,WAAO5B,SAASoB,KAAT;AAHe,GAAxB;AAKD;;AAEDlB,KAAKC,gBAAL,CAAsB,SAAtB,EAAiC,UAACC,KAAD,EAAW;AAC1C,UAAQA,MAAMmB,IAAN,CAAWI,IAAnB;AACE,SAAK,eAAL;AACER,cAAQf,MAAMmB,IAAN,CAAWH,KAAnB,EAA0BhB,MAAMmB,IAAN,CAAWF,IAArC;AACA;AACF,SAAK,kBAAL;AACEG,iBAAWpB,MAAMmB,IAAN,CAAWH,KAAtB,EAA6BhB,MAAMmB,IAAN,CAAWE,MAAxC;AACA;AACF,SAAK,gBAAL;AACEC,eAAStB,MAAMmB,IAAN,CAAWH,KAApB;AACA;AATJ;AAWD,CAZD","file":"ServiceWorker.js","sourcesContent":["/* globals clients */\r\n\r\nconst fileCache = Object.create(null)\r\n\r\nfunction getCache (name) {\r\n  if (!fileCache[name]) {\r\n    fileCache[name] = Object.create(null)\r\n  }\r\n  return fileCache[name]\r\n}\r\n\r\nself.addEventListener('install', (event) => {\r\n  console.log('Installing Uppy Service Worker...')\r\n\r\n  event.waitUntil(Promise.resolve()\r\n    .then(() => self.skipWaiting()))\r\n})\r\n\r\nself.addEventListener('activate', (event) => {\r\n  event.waitUntil(self.clients.claim())\r\n})\r\n\r\nfunction sendMessageToAllClients (msg) {\r\n  clients.matchAll().then((clients) => {\r\n    clients.forEach((client) => {\r\n      client.postMessage(msg)\r\n    })\r\n  })\r\n}\r\n\r\nfunction addFile (store, file) {\r\n  getCache(store)[file.id] = file.data\r\n  console.log('Added file blob to service worker cache:', file.data)\r\n}\r\n\r\nfunction removeFile (store, fileID) {\r\n  delete getCache(store)[fileID]\r\n  console.log('Removed file blob from service worker cache:', fileID)\r\n}\r\n\r\nfunction getFiles (store) {\r\n  sendMessageToAllClients({\r\n    type: 'uppy/ALL_FILES',\r\n    store: store,\r\n    files: getCache(store)\r\n  })\r\n}\r\n\r\nself.addEventListener('message', (event) => {\r\n  switch (event.data.type) {\r\n    case 'uppy/ADD_FILE':\r\n      addFile(event.data.store, event.data.file)\r\n      break\r\n    case 'uppy/REMOVE_FILE':\r\n      removeFile(event.data.store, event.data.fileID)\r\n      break\r\n    case 'uppy/GET_FILES':\r\n      getFiles(event.data.store)\r\n      break\r\n  }\r\n})\r\n"]}