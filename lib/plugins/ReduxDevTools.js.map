{"version":3,"sources":["../../src/plugins/ReduxDevTools.js"],"names":["Plugin","require","module","exports","uppy","opts","type","id","title","defaultOptions","handleStateChange","bind","initDevTools","prevState","nextState","patch","devTools","send","window","devToolsExtension","connect","devToolsUnsubscribe","subscribe","message","console","log","payload","reset","computedStates","nextLiftedState","store","state","getState","length","updateAll","JSON","parse","install","withDevTools","__REDUX_DEVTOOLS_EXTENSION__","on","uninstall","off","handleStateUpdate"],"mappings":";;;;;;;;AAAA,IAAMA,SAASC,QAAQ,gBAAR,CAAf;;AAEA;;;;;;AAMAC,OAAOC,OAAP;AAAA;;AACE,yBAAaC,IAAb,EAAmBC,IAAnB,EAAyB;AAAA;;AAAA,iDACvB,mBAAMD,IAAN,EAAYC,IAAZ,CADuB;;AAEvB,UAAKC,IAAL,GAAY,UAAZ;AACA,UAAKC,EAAL,GAAU,eAAV;AACA,UAAKC,KAAL,GAAa,gBAAb;;AAEA;AACA,QAAMC,iBAAiB,EAAvB;;AAEA;AACA,UAAKJ,IAAL,GAAY,SAAc,EAAd,EAAkBI,cAAlB,EAAkCJ,IAAlC,CAAZ;;AAEA,UAAKK,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBC,IAAvB,OAAzB;AACA,UAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBD,IAAlB,OAApB;AAbuB;AAcxB;;AAfH,0BAiBED,iBAjBF,8BAiBqBG,SAjBrB,EAiBgCC,SAjBhC,EAiB2CC,KAjB3C,EAiBkD;AAC9C,SAAKC,QAAL,CAAcC,IAAd,CAAmB,mBAAnB,EAAwCH,SAAxC;AACD,GAnBH;;AAAA,0BAqBEF,YArBF,2BAqBkB;AAAA;;AACd,SAAKI,QAAL,GAAgBE,OAAOC,iBAAP,CAAyBC,OAAzB,EAAhB;AACA,SAAKC,mBAAL,GAA2B,KAAKL,QAAL,CAAcM,SAAd,CAAwB,UAACC,OAAD,EAAa;AAC9D,UAAIA,QAAQjB,IAAR,KAAiB,UAArB,EAAiC;AAC/BkB,gBAAQC,GAAR,CAAYF,QAAQG,OAAR,CAAgBpB,IAA5B;;AAEA;AACA,gBAAQiB,QAAQG,OAAR,CAAgBpB,IAAxB;AACE,eAAK,OAAL;AACE,mBAAKF,IAAL,CAAUuB,KAAV;AACA;AACF,eAAK,cAAL;AACE,gBAAMC,iBAAiBL,QAAQG,OAAR,CAAgBG,eAAhB,CAAgCD,cAAvD;AACA,mBAAKxB,IAAL,CAAU0B,KAAV,CAAgBC,KAAhB,GAAwB,SAAc,EAAd,EAAkB,OAAK3B,IAAL,CAAU4B,QAAV,EAAlB,EAAwCJ,eAAeA,eAAeK,MAAf,GAAwB,CAAvC,EAA0CF,KAAlF,CAAxB;AACA,mBAAK3B,IAAL,CAAU8B,SAAV,CAAoB,OAAK9B,IAAL,CAAU4B,QAAV,EAApB;AACA;AACF,eAAK,eAAL;AACA,eAAK,gBAAL;AACE,mBAAK5B,IAAL,CAAU0B,KAAV,CAAgBC,KAAhB,GAAwB,SAAc,EAAd,EAAkB,OAAK3B,IAAL,CAAU4B,QAAV,EAAlB,EAAwCG,KAAKC,KAAL,CAAWb,QAAQQ,KAAnB,CAAxC,CAAxB;AACA,mBAAK3B,IAAL,CAAU8B,SAAV,CAAoB,OAAK9B,IAAL,CAAU4B,QAAV,EAApB;AAZJ;AAcD;AACF,KApB0B,CAA3B;AAqBD,GA5CH;;AAAA,0BA8CEK,OA9CF,sBA8Ca;AACT,SAAKC,YAAL,GAAoB,OAAOpB,MAAP,KAAkB,WAAlB,IAAiCA,OAAOqB,4BAA5D;AACA,QAAI,KAAKD,YAAT,EAAuB;AACrB,WAAK1B,YAAL;AACA,WAAKR,IAAL,CAAUoC,EAAV,CAAa,cAAb,EAA6B,KAAK9B,iBAAlC;AACD;AACF,GApDH;;AAAA,0BAsDE+B,SAtDF,wBAsDe;AACX,QAAI,KAAKH,YAAT,EAAuB;AACrB,WAAKjB,mBAAL;AACA,WAAKjB,IAAL,CAAUsC,GAAV,CAAc,cAAd,EAA8B,KAAKC,iBAAnC;AACD;AACF,GA3DH;;AAAA;AAAA,EAA6C3C,MAA7C","file":"ReduxDevTools.js","sourcesContent":["const Plugin = require('../core/Plugin')\r\n\r\n/**\r\n * Add Redux DevTools support to Uppy\r\n *\r\n * See https://medium.com/@zalmoxis/redux-devtools-without-redux-or-how-to-have-a-predictable-state-with-any-architecture-61c5f5a7716f\r\n * and https://github.com/zalmoxisus/mobx-remotedev/blob/master/src/monitorActions.js\r\n */\r\nmodule.exports = class ReduxDevTools extends Plugin {\r\n  constructor (uppy, opts) {\r\n    super(uppy, opts)\r\n    this.type = 'debugger'\r\n    this.id = 'ReduxDevTools'\r\n    this.title = 'Redux DevTools'\r\n\r\n    // set default options\r\n    const defaultOptions = {}\r\n\r\n    // merge default options with the ones set by user\r\n    this.opts = Object.assign({}, defaultOptions, opts)\r\n\r\n    this.handleStateChange = this.handleStateChange.bind(this)\r\n    this.initDevTools = this.initDevTools.bind(this)\r\n  }\r\n\r\n  handleStateChange (prevState, nextState, patch) {\r\n    this.devTools.send('UPPY_STATE_UPDATE', nextState)\r\n  }\r\n\r\n  initDevTools () {\r\n    this.devTools = window.devToolsExtension.connect()\r\n    this.devToolsUnsubscribe = this.devTools.subscribe((message) => {\r\n      if (message.type === 'DISPATCH') {\r\n        console.log(message.payload.type)\r\n\r\n        // Implement monitors actions\r\n        switch (message.payload.type) {\r\n          case 'RESET':\r\n            this.uppy.reset()\r\n            return\r\n          case 'IMPORT_STATE':\r\n            const computedStates = message.payload.nextLiftedState.computedStates\r\n            this.uppy.store.state = Object.assign({}, this.uppy.getState(), computedStates[computedStates.length - 1].state)\r\n            this.uppy.updateAll(this.uppy.getState())\r\n            return\r\n          case 'JUMP_TO_STATE':\r\n          case 'JUMP_TO_ACTION':\r\n            this.uppy.store.state = Object.assign({}, this.uppy.getState(), JSON.parse(message.state))\r\n            this.uppy.updateAll(this.uppy.getState())\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  install () {\r\n    this.withDevTools = typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION__\r\n    if (this.withDevTools) {\r\n      this.initDevTools()\r\n      this.uppy.on('state-update', this.handleStateChange)\r\n    }\r\n  }\r\n\r\n  uninstall () {\r\n    if (this.withDevTools) {\r\n      this.devToolsUnsubscribe()\r\n      this.uppy.off('state-update', this.handleStateUpdate)\r\n    }\r\n  }\r\n}\r\n"]}